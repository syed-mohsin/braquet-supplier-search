"use strict";var ApplicationConfiguration=function(){var a="mean",b=["ngResource","ngAnimate","ngMaterial","ngMessages","ui.router","ui.bootstrap","ui.utils","angularFileUpload"],c=function(b,c){angular.module(b,c||[]),angular.module(a).requires.push(b)};return{applicationModuleName:a,applicationModuleVendorDependencies:b,registerModule:c}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider","$httpProvider",function(a,b){a.html5Mode(!0).hashPrefix("!"),b.interceptors.push("authInterceptor")}]),angular.module(ApplicationConfiguration.applicationModuleName).run(["$rootScope","$state","Authentication",function(a,b,c){function d(a,c){a.data&&a.data.ignoreState||(b.previous={state:a,params:c,href:b.href(a,c)})}a.$on("$stateChangeStart",function(a,e,f,g,h){if(e.data&&e.data.roles&&e.data.roles.length>0){var i=!1;e.data.roles.forEach(function(a){if(void 0!==c.user.roles&&c.user.roles.indexOf(a)!==-1)return i=!0,!0}),i||(a.preventDefault(),void 0!==c.user&&"object"==typeof c.user?b.go("forbidden"):b.go("authentication.signin").then(function(){d(e,f)}))}}),a.$on("$stateChangeSuccess",function(a,b,c,e,f){d(e,f)})}]),angular.element(document).ready(function(){if(window.location.hash&&"#_=_"===window.location.hash)if(window.history&&history.pushState)window.history.pushState("",document.title,window.location.pathname);else{var a={top:document.body.scrollTop,left:document.body.scrollLeft};window.location.hash="",document.body.scrollTop=a.top,document.body.scrollLeft=a.left}angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("bids"),ApplicationConfiguration.registerModule("chat"),ApplicationConfiguration.registerModule("connections"),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("core.admin",["core"]),ApplicationConfiguration.registerModule("core.admin.routes",["ui.router"]),ApplicationConfiguration.registerModule("organizations"),ApplicationConfiguration.registerModule("panels"),ApplicationConfiguration.registerModule("projects"),ApplicationConfiguration.registerModule("reviews"),ApplicationConfiguration.registerModule("users",["core"]),ApplicationConfiguration.registerModule("users.admin",["core.admin"]),ApplicationConfiguration.registerModule("users.admin.routes",["core.admin.routes"]),angular.module("bids").run(["Menus",function(a){a.addMenuItem("topbar",{title:"Bids",state:"bids",type:"dropdown",roles:["seller"]}),a.addSubMenuItem("topbar","bids",{title:"My Bids",state:"bids.list",roles:["seller"]}),a.addSubMenuItem("topbar","bids",{title:"Place Bids",state:"projects.list",roles:["seller"]})}]),angular.module("bids").config(["$stateProvider",function(a){a.state("bids",{abstract:!0,url:"/bids",template:"<ui-view/>"}).state("bids.list",{url:"",templateUrl:"modules/bids/client/views/list-bids.client.view.html",data:{roles:["seller"]}}).state("bids.view",{url:"/:bidId",templateUrl:"modules/bids/client/views/view-bid.client.view.html",data:{roles:["user","seller"]}})}]),angular.module("bids").controller("BidsController",["$scope","$stateParams","$resource","$location","$interval","$filter","Authentication","Socket","Projects","Bids",function(a,b,c,d,e,f,g,h,i,j){a.authentication=g,a.bids=j.query(),h.socket||(h.connect(),console.log("connected to server")),a.$on("$destroy",function(){h.removeListener("chatMessage")}),h.on("refreshBidList",function(b){"seller"===g.user.roles[0]&&"/bids"===d.url()&&a.findMyBids()}),a.remove=function(b){if(b){b.$remove();for(var c in a.bids)a.bids[c]===b&&a.Bids.splice(c,1)}else a.bid.$remove(function(){d.path("bids")})},a.find=function(){a.bids=j.query()},a.findMyBids=function(){a.bids=j.query({},function(b){for(var c=a.bids.length-1;c>=0;c--)a.bids[c].user._id!==g.user._id&&a.bids.splice(c,1)})},a.findOne=function(){a.bid=j.get({bidId:b.bidId},function(a){},function(a){d.path("/forbidden")})},a.findProject=function(){var c=b.projectId;a.project=i.get({projectId:c})},a.createDate=function(){a.date={value:new Date,currentDate:new Date,threeYearAheadDate:(new Date).setFullYear((new Date).getFullYear()+3)}},a.getMatches=function(b){var c=f("filter")(a.project.panel_models,{$:b});return c}}]),angular.module("bids").controller("CreateBidController",["$scope","$stateParams","$resource","$location","$interval","$filter","$modalInstance","Authentication","Socket","Projects","Bids","modalProjectId",function(a,b,c,d,e,f,g,h,i,j,k,l){a.authentication=h,a.panel_models=[],a.create=function(b){if(a.error=null,new Date>new Date(a.project.bid_deadline))return a.error="Bid Deadline has passed",!1;if(!this.panel_models.length)return a.error="Please select at least one panel model",!1;if(!b)return a.$broadcast("show-errors-check-validity","bidForm"),!1;var c=new k({fob_shipping:this.fob_shipping,delivery_date:this.date.value,quantity:this.quantity,panel_models:this.panel_models,subtotal:100*this.subtotal,shipping_cost:100*this.shipping_cost,sales_tax:100*this.sales_tax,payment_term:this.payment_term,project:a.project._id,project_title:a.project.note});c.$save(function(b){g.close(),a.fob_shipping="",a.delivery_date="",a.subtotal="",a.sales_tax="",a.quantity="",a.panel_models=null,a.shipping_cost="",a.payment_term=""},function(b){a.error=b.data.message})},a.findOne=function(){a.bid=k.get({bidId:b.bidId},function(a){},function(a){d.path("/forbidden")})},a.findProject=function(){var c=l||b.projectId;a.project=j.get({projectId:c})},a.createDate=function(){a.date={value:new Date,currentDate:new Date,threeYearAheadDate:(new Date).setFullYear((new Date).getFullYear()+3)}},a.getMatches=function(b){var c=f("filter")(a.project.panel_models,{$:b});return c}}]),angular.module("bids").factory("Bids",["$resource",function(a){return a("api/bids/:bidId",{bidId:"@_id"},{update:{method:"PUT"}})}]),angular.module("chat").run(["Menus",function(a){a.addMenuItem("topbar",{title:"Chat",state:"chat",roles:["user","seller","admin"]})}]),angular.module("chat").config(["$stateProvider",function(a){a.state("chat",{url:"/chat",templateUrl:"modules/chat/client/views/chat.client.view.html",data:{roles:["user","admin","seller"]}})}]),angular.module("chat").controller("ChatController",["$scope","$http","$location","$modal","Authentication","Socket",function(a,b,c,d,e,f){a.chats=[],a.chat=void 0,b.get("/api/connections").success(function(b){a.connections=b}),b.get("/api/chats").success(function(b){a.chats=b,a.chats.map(function(a){return a.recipient=a.members.filter(function(a){if(a._id!==e.user._id)return a})[0],a})}),e.user||c.path("/"),f.socket||f.connect(),f.on("newChat",function(b){b.members.forEach(function(a){a._id!==e.user._id&&(b.recipient=a)}),a.chats.push(b)}),f.on("chatMessage",function(b){var c=b.chatId,d=b.message;a.chats.forEach(function(b,e){b._id===c&&a.chats[e].messages.push(d)})}),a.sendMessage=function(){if(!a.chat)return!1;var b={content:this.messageText},c={chatId:a.chat._id,members:a.chat.members,message:b};f.emit("chatMessage",c),this.messageText=""},a.$on("$destroy",function(){f.removeListener("chatMessage")}),a.selectChat=function(b){a.chat=b,a.chat.members.forEach(function(b){b._id!==e.user._id&&(a.chat.recipient=b)})},a.showAddChats=function(b){console.log(b);var c=d.open({templateUrl:"/modules/chat/client/views/add-chats.client.view.html",windowClass:"app-modal-window",scope:a,controller:["$scope","$http","$filter","$modalInstance",function(a,b,c,d){a.selectedChatter=void 0,console.log("connections",a.connections),a.buildPager=function(){a.pagedItems=[],a.itemsPerPage=15,a.currentPage=1,a.figureOutItemsToDisplay()},a.figureOutItemsToDisplay=function(){a.selectedChatter?a.filteredItems=[]:a.filteredItems=c("filter")(a.connections,{$:a.search}),a.filterLength=a.filteredItems.length;var b=(a.currentPage-1)*a.itemsPerPage,d=b+a.itemsPerPage;a.pagedItems=a.filteredItems.slice(b,d)},a.pageChanged=function(){a.figureOutItemsToDisplay()},a.buildPager(),a.selectChatter=function(b){var c=a.connections.indexOf(b);a.selectedChatter=a.connections[c],a.figureOutItemsToDisplay()},a.unselectChatter=function(){a.selectedChatter=void 0,a.figureOutItemsToDisplay()},a.createChat=function(){var c=a.chats.filter(function(b){return b.members.some(function(b){return b._id===a.selectedChatter._id})});return c.length?void d.close(c[0]):void b.post("/api/chats/",a.selectedChatter).success(function(b){b.recipient=a.selectedChatter,d.close(b)}).error(function(b){a.error=b.message})}}]});c.result.then(function(b){a.chat=b})}}]),angular.module("connections").run(["Menus",function(a){a.addMenuItem("topbar",{title:"Connections",state:"connections",type:"dropdown",roles:["user","seller"]}),a.addSubMenuItem("topbar","connections",{title:"Show Connections",state:"connections.list",roles:["user","seller"]}),a.addSubMenuItem("topbar","connections",{title:"Add Connections",state:"connections.create",roles:["user","seller"]})}]),angular.module("connections").config(["$stateProvider",function(a){a.state("connections",{abstract:!0,url:"/connections",template:"<ui-view/>"}).state("connections.list",{url:"",templateUrl:"modules/connections/client/views/list-connections.client.view.html",data:{roles:["user","seller"]}}).state("connections.create",{url:"/create",templateUrl:"modules/connections/client/views/create-connection.client.view.html",data:{roles:["user","seller","admin"]}}).state("connections.view",{url:"/:connectionId",templateUrl:"modules/connections/client/views/view-connection.client.view.html",data:{roles:["user","seller","admin"]}})}]),angular.module("connections").controller("ConnectionsController",["$scope","$state","$stateParams","$http","$location","$timeout","$interval","$filter","Authentication","Socket","GetBids","PanelModels","Projects","Connections",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.authentication=i,n.query(function(b){a.connections=b,a.buildPager()}),a.inviteByEmail=function(b){return a.success=a.error=null,console.log(b),b?void d.post("/api/connection-auth/send-invite",a.credentials).success(function(b){a.credentials=null,a.success=b.message,console.log(b)}).error(function(b){a.credentials=null,a.error=b.message}):(a.$broadcast("show-errors-check-validity","InviteByEmailForm"),!1)},a.acceptRequest=function(b){d.post("/api/connection-auth/accept-invite",b).success(function(c){var d=a.connection_requests.indexOf(b);a.connection_requests[d].isAccepted=!0,a.connection_requests.splice(d,1),a.connections.push(b)})},a.create=function(c){a.error=null;var d=new n({user:c});d.$save(function(a){b.go("connections")},function(b){a.error=b.data.message})},a.update=function(c){if(!c)return a.$broadcast("show-errors-check-validity","connectionForm"),!1;var d=a.connection;d.$update(function(){b.go("connections.view",{connectionId:d._id})},function(b){a.error=b.data.message})},a.remove=function(c){confirm("Are you sure you want to delete this connection?")&&(c?(c.$remove(),a.connections.splice(a.connections.indexOf(c),1)):a.connection.$remove(function(){b.go("connections")}))},a.find=function(){n.query({},function(b){a.connections=b}),d.get("/api/connection-requests").success(function(b){a.connection_requests=b})},a.findOne=function(){n.get({connectionId:c.connectionId},function(b){a.connection=b},function(a){e.path("/forbidden")})},a.buildPager=function(){a.pagedItems=[],a.itemsPerPage=15,a.currentPage=1,a.figureOutItemsToDisplay()},a.figureOutItemsToDisplay=function(){a.filteredItems=h("filter")(a.connections,{$:a.search}),a.filterLength=a.filteredItems.length;var b=(a.currentPage-1)*a.itemsPerPage,c=b+a.itemsPerPage;a.pagedItems=a.filteredItems.slice(b,c)},a.pageChanged=function(){a.figureOutItemsToDisplay()}}]),angular.module("connections").factory("Connections",["$resource",function(a){return a("api/connections/:connectionId",{connectionId:"@_id"},{update:{method:"PUT"}})}]),angular.module("core.admin").run(["Menus",function(a){a.addMenuItem("topbar",{title:"Admin",state:"admin",type:"dropdown",roles:["admin"]})}]),angular.module("core.admin.routes").config(["$stateProvider",function(a){a.state("admin",{abstract:!0,url:"/admin",template:"<ui-view/>",data:{roles:["admin"]}})}]),angular.module("core").config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise(function(a,b){a.get("$state").transitionTo("not-found",null,{location:!1})}),a.state("home",{url:"/",controller:["$state","Authentication",function(a,b){var c=b.user;c?"tempUser"===c.roles[0]||"tempSeller"===c.roles[0]?a.go("awaiting-confirmation"):c.roles.indexOf("seller")!==-1?a.go("organizations.view",{organizationId:c.organization}):c.roles.indexOf("user")!==-1&&a.go("catalog"):a.go("search")}]}).state("search",{url:"/search",templateUrl:"modules/core/client/views/search.client.view.html"}).state("catalog",{url:"/catalog?q&man&pow&page",templateUrl:"modules/core/client/views/catalog.client.view.html"}).state("awaiting-confirmation",{url:"/awaiting-confirmation",templateUrl:"modules/core/client/views/awaiting-confirmation.client.view.html",controller:["$state","Authentication",function(a,b){var c=b.user;c.verified&&c.emailVerified&&a.go("home")}]}).state("not-found",{url:"/not-found",templateUrl:"modules/core/client/views/404.client.view.html",data:{ignoreState:!0}}).state("bad-request",{url:"/bad-request",templateUrl:"modules/core/client/views/400.client.view.html",data:{ignoreState:!0}}).state("forbidden",{url:"/forbidden",templateUrl:"modules/core/client/views/403.client.view.html",data:{ignoreState:!0}})}]),angular.module("core").controller("CatalogController",["$scope","$filter","$http","$state","$stateParams","Authentication","PanelModels",function(a,b,c,d,e,f,g){a.authentication=f,a.search=e.q,a.query={},a.query.q=e.q,a.query.man=e.man,a.query.pow=e.pow,a.query.page=e.page,a.hiddenFilterClass="hidden-xs",c({url:"/api/organizations-catalog",params:{q:e.q,man:e.man,pow:e.pow,page:e.page}}).success(function(b){a.orgs=b.orgs,a.buildPager(b.count),a.buildWattCheckboxes(),a.buildOrgCheckboxes()}),a.updateFilter=function(){var b="",c="";for(var e in a.wattCheckboxes)a.wattCheckboxes[e]&&(c+=a.rangesReverse[e]+"|");for(e in a.orgCheckboxes)a.orgCheckboxes[e]&&(b+=e+"|");a.query.man=b,a.query.pow=c,a.query.page=1,d.go("catalog",a.query)},a.toggleFilter=function(){a.hiddenFilterClass=a.hiddenFilterClass?"":"hidden-xs"},a.buildWattCheckboxes=function(){a.ranges={100:"0 - 100 Watts",200:"101 - 200 Watts",300:"201 - 300 Watts",400:"301 - 400 Watts",500:"401 - 500 Watts"},a.rangesReverse={"0 - 100 Watts":"100","101 - 200 Watts":"200","201 - 300 Watts":"300","301 - 400 Watts":"400","401 - 500 Watts":"500"},a.wattCheckboxes={};var b=e.pow?e.pow.split("|"):[];for(var c in a.ranges)a.wattCheckboxes[a.ranges[c]]=b.indexOf(c)!==-1},a.buildOrgCheckboxes=function(){c.get("/api/panelmodels-manufacturers").success(function(b){a.manufacturers=b,a.orgCheckboxes={};var c=e.man?e.man.split("|"):[];b.forEach(function(b){a.orgCheckboxes[b]=c.indexOf(b)!==-1})})},a.buildPager=function(b){a.itemsPerPage=15,a.totalCount=b,a.currentPage=e.page},a.pageChanged=function(){a.query.page=a.currentPage,d.go("catalog",a.query)},a.searchSubmit=function(){a.query.q=a.search,d.go("catalog",a.query)}}]),angular.module("core").controller("HeaderController",["$scope","$state","Authentication","Menus",function(a,b,c,d){a.$state=b,a.authentication=c,a.menu=d.getMenu("topbar"),a.isCollapsed=!1,a.toggleCollapsibleMenu=function(){a.isCollapsed=!a.isCollapsed},a.$on("$stateChangeSuccess",function(){a.isCollapsed=!1})}]),angular.module("core").controller("HomeController",["$scope","$state","Authentication",function(a,b,c){a.authentication=c,a.goToCatalog=function(){b.go("catalog")}}]),angular.module("core").directive("countdown",["Util","$interval",function(a,b){return{restrict:"A",scope:{date:"="},link:function(c,d,e){var f;c.$watch("date",function(){void 0===c.date&&console.log(e),f=new Date(c.date)});b(function(){var b;return b=Math.floor((f.getTime()-(new Date).getTime())/1e3),d.text(a.dhms(b))},1e3)}}}]).factory("Util",[function(){return{dhms:function(a){var b,c,d,e;return b=Math.floor(a/86400),a-=86400*b,c=Math.floor(a/3600)%24,a-=3600*c,d=Math.floor(a/60)%60,a-=60*d,e=a%60,[b+"d",c+"h",d+"m",e+"s"].join(" ")}}}]),angular.module("core").directive("showErrors",["$timeout","$interpolate",function(a,b){var c=function(c,d,e,f){var g,h,i,j,k,l,m=!1,n=!1;if(j=c.$eval(e.showErrors)||{},k=j.showSuccess||!1,g=d[0].querySelector(".form-control[name]")||d[0].querySelector("[name]"),i=angular.element(g),h=b(i.attr("name")||"")(c),!h)throw"show-errors element has no child input elements with a 'name' attribute class";var o=function(){return a(function(){d.removeClass("has-error"),d.removeClass("has-success"),n=!1},0,!1)};c.$watch(function(){return f[h]&&f[h].$invalid},function(a){return l(a)}),c.$on("show-errors-check-validity",function(a,b){if(angular.isUndefined(b)||f.$name===b)return m=!0,n=!0,l(f[h].$invalid)}),c.$on("show-errors-reset",function(a,b){if(angular.isUndefined(b)||f.$name===b)return o()}),l=function(a){if(d.toggleClass("has-error",n&&a),k)return d.toggleClass("has-success",n&&!a)}};return{restrict:"A",require:"^form",compile:function(a,b){if(b.showErrors.indexOf("skipFormGroupCheck")===-1&&!a.hasClass("form-group")&&!a.hasClass("input-group"))throw"show-errors element does not have the 'form-group' or 'input-group' class";return c}}}]),angular.module("core").factory("authInterceptor",["$q","$injector",function(a,b){return{responseError:function(c){if(!c.config.ignoreAuthModule)switch(c.status){case 401:b.get("$state").transitionTo("authentication.signin");break;case 403:b.get("$state").transitionTo("forbidden")}return a.reject(c)}}}]),angular.module("core").service("Menus",[function(){this.defaultRoles=["user","admin"],this.menus={};var a=function(a){if(~this.roles.indexOf("*"))return!0;if(!a)return!1;for(var b in a.roles)for(var c in this.roles)if(this.roles[c]===a.roles[b])return!0;return!1};this.validateMenuExistance=function(a){if(a&&a.length){if(this.menus[a])return!0;throw new Error("Menu does not exist")}throw new Error("MenuId was not provided")},this.getMenu=function(a){return this.validateMenuExistance(a),this.menus[a]},this.addMenu=function(b,c){return c=c||{},this.menus[b]={roles:c.roles||this.defaultRoles,items:c.items||[],shouldRender:a},this.menus[b]},this.removeMenu=function(a){this.validateMenuExistance(a),delete this.menus[a]},this.addMenuItem=function(b,c){if(c=c||{},this.validateMenuExistance(b),this.menus[b].items.push({title:c.title||"",state:c.state||"",type:c.type||"item",class:c.class,roles:null===c.roles||"undefined"==typeof c.roles?this.defaultRoles:c.roles,position:c.position||0,items:[],shouldRender:a}),c.items)for(var d in c.items)this.addSubMenuItem(b,c.state,c.items[d]);return this.menus[b]},this.addSubMenuItem=function(b,c,d){d=d||{},this.validateMenuExistance(b);for(var e in this.menus[b].items)this.menus[b].items[e].state===c&&this.menus[b].items[e].items.push({title:d.title||"",state:d.state||"",roles:null===d.roles||"undefined"==typeof d.roles?this.menus[b].items[e].roles:d.roles,position:d.position||0,shouldRender:a});return this.menus[b]},this.removeMenuItem=function(a,b){this.validateMenuExistance(a);for(var c in this.menus[a].items)this.menus[a].items[c].state===b&&this.menus[a].items.splice(c,1);return this.menus[a]},this.removeSubMenuItem=function(a,b){this.validateMenuExistance(a);for(var c in this.menus[a].items)for(var d in this.menus[a].items[c].items)this.menus[a].items[c].items[d].state===b&&this.menus[a].items[c].items.splice(d,1);return this.menus[a]},this.addMenu("topbar",{roles:["*"]})}]),angular.module("core").service("Socket",["Authentication","$state","$timeout",function(a,b,c){this.connect=function(){a.user&&(this.socket=io())},this.connect(),this.on=function(a,b){this.socket&&this.socket.on(a,function(a){c(function(){b(a)})})},this.emit=function(a,b){this.socket&&this.socket.emit(a,b)},this.removeListener=function(a){this.socket&&this.socket.removeListener(a)}}]),angular.module("organizations").run(["Menus",function(a){a.addMenuItem("topbar",{title:"Organizations",state:"organizations",type:"dropdown",roles:["user","seller"]}),a.addSubMenuItem("topbar","organizations",{title:"Show Organizations",state:"organizations.list",roles:["user","seller"]}),a.addSubMenuItem("topbar","organizations",{title:"Add Organizations",state:"organizations.create",roles:["admin"]})}]),angular.module("organizations").config(["$stateProvider",function(a){a.state("organizations",{abstract:!0,url:"/organizations",template:"<ui-view/>"}).state("organizations.list",{url:"",templateUrl:"modules/organizations/client/views/list-organizations.client.view.html",data:{roles:["user","seller"]}}).state("organizations.create",{url:"/create",templateUrl:"modules/organizations/client/views/create-organization.client.view.html",data:{roles:["admin"]}}).state("organizations.view",{url:"/:organizationId",templateUrl:"modules/organizations/client/views/view-organization.client.view.html",data:{roles:["user","seller","admin"]}}).state("organizations.edit",{url:"/:organizationId/edit",templateUrl:"modules/organizations/client/views/edit-organization.client.view.html",data:{roles:["user","seller","admin"]}})}]),angular.module("organizations").controller("OrganizationsController",["$scope","$state","$stateParams","$http","$location","$timeout","$interval","$filter","$window","$modal","FileUploader","Authentication","Socket","GetBids","PanelModels","Projects","Organizations",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){a.authentication=l,a.user=l.user,a.uploader=new k({url:"api/organizations/logo/",alias:"newLogo"}),q.query(function(b){a.organizations=b,a.buildPager()}),a.loadPanelModelsData=function(){a.panel_models=[],a.panelData=o.query(),a.getMatches=function(b){var c=h("filter")(a.panelData,{$:b});return c}},a.create=function(c){if(a.error=null,!c)return a.$broadcast("show-errors-check-validity","organizationForm"),!1;var d=new q({companyName:this.companyName,industry:this.industry,productTypes:this.product_types,panel_models:this.panel_models,url:this.url,address1:this.address1,address2:this.address2,city:this.city,state:this.state,zipcode:this.zipcode,country:this.country,about:this.about});d.$save(function(a){b.go("organizations.view",{organizationId:a._id})},function(b){a.error=b.data.message})},a.update=function(c){if(!c)return a.$broadcast("show-errors-check-validity","organizationForm"),!1;var d=a.organization;d.$update(function(){b.go("organizations.view",{organizationId:d._id})},function(b){a.error=b.data.message})},a.remove=function(c){confirm("Are you sure you want to delete this organization?")&&(c?(c.$remove(),a.organizations.splice(a.organizations.indexOf(c),1)):a.organization.$remove(function(){b.go("organizations")}))},a.find=function(){q.query({},function(b){a.organizations=b})},a.findOne=function(){q.get({organizationId:c.organizationId},function(b){a.organization=b,a.buildUploader(b._id)},function(a){e.path("/forbidden")})},a.buildPager=function(){a.pagedItems=[],a.itemsPerPage=15,a.currentPage=1,a.figureOutItemsToDisplay()},a.figureOutItemsToDisplay=function(){a.filteredItems=h("filter")(a.organizations,{$:a.search}),a.filterLength=a.filteredItems.length;var b=(a.currentPage-1)*a.itemsPerPage,c=b+a.itemsPerPage;a.pagedItems=a.filteredItems.slice(b,c)},a.pageChanged=function(){a.figureOutItemsToDisplay()},a.buildUploader=function(b){a.uploader.url="api/organizations/logo/"+b,a.uploader.filters.push({name:"imageFilter",fn:function(a,b){var c="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(c)!==-1}}),a.uploader.onAfterAddingFile=function(b){if(i.FileReader){var c=new FileReader;c.readAsDataURL(b._file),c.onload=function(b){f(function(){a.organization.logoImageUrl=b.target.result},0)}}},a.uploader.onSuccessItem=function(b,c,d,e){a.success=!0,a.organization=c,a.cancelUpload()},a.uploader.onErrorItem=function(b,c,d,e){a.cancelUpload(),a.error=c.message},a.uploadProfilePicture=function(){a.success=a.error=null,a.uploader.uploadAll()},a.cancelUpload=function(){a.uploader.clearQueue(),a.imageURL=a.user.profileImageURL}},a.showReviewView=function(b,c){var d=j.open({templateUrl:"/modules/reviews/client/views/create-review.client.view.html",controller:"CreateReviewsController",resolve:{modalOrganizationId:function(){return c}},windowClass:"app-modal-window"});d.result.then(function(){c&&a.findOne()})},a.showAddUsers=function(b){console.log(b);var c=j.open({templateUrl:"/modules/organizations/client/views/add-users.client.view.html",windowClass:"app-modal-window",controller:["$scope","$http","$modalInstance","Users",function(a,b,c,d){a.addedUsers=[],a.potentialUsers=a.organization.possibleUsers,a.buildPager=function(){a.pagedItems=[],a.itemsPerPage=5,a.currentPage=1,a.figureOutItemsToDisplay()},a.figureOutItemsToDisplay=function(){a.filteredItems=h("filter")(a.potentialUsers,{$:a.search}),a.filterLength=a.filteredItems.length;var b=(a.currentPage-1)*a.itemsPerPage,c=b+a.itemsPerPage;a.pagedItems=a.filteredItems.slice(b,c)},a.buildPager(),a.pageChanged=function(){a.figureOutItemsToDisplay()},a.toggle=function(b){var c=a.potentialUsers.indexOf(b),d=a.addedUsers.indexOf(b);c!==-1&&d===-1?a.addedUsers.push(a.potentialUsers.splice(c,1)[0]):c===-1&&d!==-1&&a.potentialUsers.push(a.addedUsers.splice(d,1)[0]),a.figureOutItemsToDisplay()},a.acceptUsers=function(){b.post("/api/organizations/"+a.organization._id+"/addUsers",a.addedUsers).success(function(b){a.organization=b,c.close()}).error(function(b){a.error=b.message})}}],scope:a});c.result.then(function(){a.findOne()})}}]),angular.module("organizations").factory("Organizations",["$resource",function(a){return a("api/organizations/:organizationId",{organizationId:"@_id"},{update:{method:"PUT"}})}]),angular.module("panels").controller("PanelController",["$scope","$stateParams","$filter","$timeout","$window","FileUploader","PanelModels",function(a,b,c,d,e,f,g){g.query(function(b){a.panel_models=b,a.buildPager()}),a.findOne=function(){g.get({panelId:b.panelId},function(b){a.panel=b,a.buildUploader(b._id)})},a.buildPager=function(){a.pagedItems=[],a.itemsPerPage=15,a.currentPage=1,a.figureOutItemsToDisplay()},a.figureOutItemsToDisplay=function(){a.filteredItems=c("filter")(a.panel_models,{$:a.search}),a.filterLength=a.filteredItems.length;var b=(a.currentPage-1)*a.itemsPerPage,d=b+a.itemsPerPage;a.pagedItems=a.filteredItems.slice(b,d)},a.pageChanged=function(){a.figureOutItemsToDisplay()},a.uploader=new f({url:"api/panels/photo/",alias:"newPanelModelPhoto"}),a.buildUploader=function(b){a.uploader.url="api/panels/photo/"+b,a.uploader.filters.push({name:"imageFilter",fn:function(a,b){var c="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(c)!==-1}}),a.uploader.onAfterAddingFile=function(b){if(e.FileReader){var c=new FileReader;c.readAsDataURL(b._file),c.onload=function(b){d(function(){a.panel.panelPhotoUrl=b.target.result},0)}}},a.uploader.onSuccessItem=function(b,c,d,e){a.success=!0,a.cancelUpload()},a.uploader.onErrorItem=function(b,c,d,e){a.cancelUpload(),a.error=c.message},a.uploadProfilePicture=function(b){a.success=a.error=null,console.log("inside panelPhoto upload"),a.uploader.uploadAll()},a.cancelUpload=function(){a.uploader.clearQueue(),a.imageURL=a.panel.panelPhotoUrl}}}]),angular.module("panels").factory("PanelModels",["$resource",function(a){return a("api/panelmodels/:panelId",{organizationId:"@_id"},{update:{method:"PUT"}})}]),angular.module("projects").run(["Menus",function(a){a.addMenuItem("topbar",{title:"Request for Quotes",state:"projects",type:"dropdown",roles:["user","seller"]}),a.addSubMenuItem("topbar","projects",{title:"See RFQs",state:"projects.list",roles:["user","seller"]}),a.addSubMenuItem("topbar","projects",{title:"Submit a RFQ",state:"projects.create",roles:["user"]})}]),angular.module("projects").config(["$stateProvider",function(a){a.state("projects",{abstract:!0,url:"/projects",template:"<ui-view/>"}).state("projects.list",{url:"",templateUrl:"modules/projects/client/views/list-projects.client.view.html",data:{roles:["user","seller"]}}).state("projects.create",{url:"/create",templateUrl:"modules/projects/client/views/create-project.client.view.html",data:{roles:["user","admin"]}}).state("projects.view",{url:"/:projectId",templateUrl:"modules/projects/client/views/view-project.client.view.html"}).state("projects.edit",{url:"/:projectId/edit",templateUrl:"modules/projects/client/views/edit-project.client.view.html",data:{roles:["user","admin"]}})}]),angular.module("projects").controller("ProjectsController",["$scope","$state","$stateParams","$location","$timeout","$interval","$filter","$modal","Authentication","Socket","GetBids","PanelModels","Projects",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.authentication=i,j.socket||(j.connect(),console.log("connected to server")),a.$on("$destroy",function(){j.removeListener("refreshProjectView"),j.removeListener("refreshProjectList")}),j.on("refreshProjectView",function(b){c.projectId===b&&a.findOne()}),j.on("refreshProjectList",function(b){"seller"===i.user.roles[0]&&"/projects"===d.url()?a.find():i.user._id===b&&a.find()}),j.on("bidDeadlineList",function(b){if(console.log("Bid has terminated"),console.log(b),console.log("State param is: "+c.projectId),a.project&&c.projectId===b)a.project.canBid=!1,a.project.bidOpen=!1,console.log("WE ARE IN PROJECT VIEW");else if("/projects"===d.url()&&a.projects){console.log("WE ARE IN PROJECT LIST");for(var e=0;e<a.projects.length;e++)if(a.projects[e]._id===b)return a.projects[e].canBid=!1,void(a.projects[e].bidOpen=!1)}}),a.create=function(b){if(a.error=null,!b)return a.$broadcast("show-errors-check-validity","projectForm"),!1;if(!a.panel_models.length)return a.error="At least one panel model is required",!1;var c=new m({note:this.note,quantity:this.quantity,bid_deadline:this.bid_date.value,panel_models:this.panel_models,project_state:this.project_state,shipping_address_1:this.shipping_address_1,shipping_address_2:this.shipping_address_2,shipping_address_city:this.shipping_address_city,shipping_address_state:this.shipping_address_state,shipping_address_zip_code:this.shipping_address_zip_code,shipping_address_country:this.shipping_address_country,preferred_payment_term:this.preferred_payment_term});c.$save(function(b){d.path("projects/"+b._id),a.note="",a.quantity="",a.bid_deadline="",a.shipping_address_1="",a.shipping_address_2="",a.shipping_address_city="",a.shipping_address_state="",a.shipping_address_zip_code="",a.shipping_address_country="",a.preferred_payment_term=""},function(b){a.error=b.data.message})},a.remove=function(b){if(b){b.$remove();for(var c in a.projects)a.projects[c]===b&&a.Projects.splice(c,1)}else a.project.$remove(function(){d.path("projects")})},a.update=function(b){if(a.error=null,!a.project.panel_models.length)return a.error="At least one panel model is required",!1;if(!b)return a.$broadcast("show-errors-check-validity","projectForm"),!1;var c=a.project;c.$update(function(){d.path("projects/"+c._id)},function(b){a.error=b.data.message})},a.showBidView=function(d,e){console.log(d),console.log(b.href("bids.create",{projectId:c.projectId},{absolute:!0,inherit:!1})),console.log(angular.element);var f=h.open({templateUrl:"/modules/bids/client/views/create-bid.client.view.html",controller:"CreateBidController",resolve:{modalProjectId:function(){return e}},windowClass:"app-modal-window"});f.result.then(function(){e?a.find():a.findOne()})},a.showAddBidders=function(b){if(console.log(b),"private"!==a.project.project_state)return!1;var c=h.open({templateUrl:"/modules/projects/client/views/add-bidders.client.view.html",windowClass:"app-modal-window",controller:["$scope","$http","$modalInstance",function(a,b,c){a.addedBidders=[],a.potentialBidders=a.project.user.connections.slice(),a.buildPager=function(){a.pagedItems=[],a.itemsPerPage=15,a.currentPage=1,a.figureOutItemsToDisplay();
},a.figureOutItemsToDisplay=function(){a.filteredItems=g("filter")(a.potentialBidders,{$:a.search}),a.filterLength=a.filteredItems.length;var b=(a.currentPage-1)*a.itemsPerPage,c=b+a.itemsPerPage;a.pagedItems=a.filteredItems.slice(b,c)},a.pageChanged=function(){a.figureOutItemsToDisplay()},a.buildPager(),a.toggle=function(b){var c=a.potentialBidders.indexOf(b),d=a.addedBidders.indexOf(b);c!==-1&&d===-1?a.addedBidders.push(a.potentialBidders.splice(c,1)[0]):c===-1&&d!==-1&&a.potentialBidders.push(a.addedBidders.splice(d,1)[0]),a.figureOutItemsToDisplay()},a.acceptBidders=function(){b.post("/api/projects/"+a.project._id+"/inviteBidders",a.addedBidders).success(function(a){c.close()}).error(function(b){a.error=b.message})}}],scope:a});c.result.then(function(){a.findOne()})},a.find=function(){a.projects=m.query({},function(b){var c=new Date;b.forEach(function(b){b.canBid="seller"===a.authentication.user.roles[0]&&c<new Date(b.bid_deadline),b.bidOpen=c<new Date(b.bid_deadline)})})},a.findOne=function(){a.project=m.get({projectId:c.projectId},function(b){a.project.bid_deadline=new Date(b.bid_deadline),a.project.canBid="seller"===a.authentication.user.roles[0]&&new Date<new Date(b.bid_deadline),a.project.bidOpen=new Date<new Date(b.bid_deadline),a.bid_date={currentDate:new Date,yearAheadDate:(new Date).setFullYear((new Date).getFullYear()+1)}},function(a){d.path("/forbidden")})},a.myDta=l.query(),a.getMatches=function(b){var c=g("filter")(a.myDta,{$:b});return c},a.createDate=function(){a.panel_models=[];var b=new Date,c=new Date;c.setDate(c.getDate()+1);var d=new Date;d.setFullYear(d.getFullYear()+1),a.bid_date={value:c,currentDate:b,yearAheadDate:d}}}]),angular.module("projects").factory("Projects",["$resource",function(a){return a("api/projects/:projectId",{projectId:"@_id"},{update:{method:"PUT"}})}]),angular.module("projects").factory("GetBids",["$resource",function(a){return a("api/projects/getbids/:projectId")}]),angular.module("reviews").run(["Menus",function(a){a.addMenuItem("topbar",{title:"My Reviews",state:"reviews.list",roles:["user","seller","admin"]})}]),angular.module("reviews").config(["$stateProvider",function(a){a.state("reviews",{abstract:!0,url:"/reviews",template:"<ui-view/>"}).state("reviews.list",{url:"",templateUrl:"modules/reviews/client/views/list-reviews.client.view.html"}).state("reviews.view",{url:"/:reviewId",templateUrl:"modules/reviews/client/views/view-review.client.view.html"}).state("reviews.edit",{url:"/:reviewId/edit",templateUrl:"modules/reviews/client/views/edit-review.client.view.html",data:{roles:["user","seller","admin"]}})}]),angular.module("reviews").controller("CreateReviewsController",["$scope","$stateParams","$location","$http","$modalInstance","Authentication","Reviews","modalOrganizationId",function(a,b,c,d,e,f,g,h){a.authentication=f,a.create=function(b){if(a.error=null,!b)return a.$broadcast("show-errors-check-validity","reviewForm"),!1;var c=new g({title:this.title,rating:this.rating,content:this.content,anonymous:this.anonymous});d.post("/api/reviews/create/"+h,c).success(function(a){e.close()}).error(function(b){b&&b.message?a.error=b.message:a.error="Something went wrong..."})}}]),angular.module("reviews").controller("ReviewsController",["$scope","$stateParams","$location","Authentication","Reviews",function(a,b,c,d,e){a.authentication=d,a.remove=function(b){if(b){b.$remove();for(var d in a.reviews)a.reviews[d]===b&&a.reviews.splice(d,1)}else a.review.$remove(function(){c.path("reviews")})},a.update=function(b){if(a.error=null,!b)return a.$broadcast("show-errors-check-validity","reviewForm"),!1;var d=a.review;d.$update(function(){c.path("reviews/"+d._id)},function(b){a.error=b.data.message})},a.find=function(){a.reviews=e.query()},a.findOne=function(){a.review=e.get({reviewId:b.reviewId})}}]),angular.module("reviews").factory("Reviews",["$resource",function(a){return a("api/reviews/:reviewId",{reviewId:"@_id"},{update:{method:"PUT"}})}]),angular.module("users.admin").run(["Menus",function(a){a.addSubMenuItem("topbar","admin",{title:"Manage Users",state:"admin.users"}),a.addSubMenuItem("topbar","admin",{title:"View Panel Models",state:"panels.list"}),a.addSubMenuItem("topbar","admin",{title:"Manage Organizations",state:"admin.organizations"})}]),angular.module("users.admin.routes").config(["$stateProvider",function(a){a.state("admin.users",{url:"/users",templateUrl:"modules/users/client/views/admin/list-users.client.view.html",controller:"UserListController"}).state("admin.user",{url:"/users/:userId",templateUrl:"modules/users/client/views/admin/view-user.client.view.html",controller:"UserController",resolve:{userResolve:["$stateParams","Admin",function(a,b){return b.get({userId:a.userId})}]}}).state("admin.user-edit",{url:"/users/:userId/edit",templateUrl:"modules/users/client/views/admin/edit-user.client.view.html",controller:"UserController",resolve:{userResolve:["$stateParams","Admin",function(a,b){return b.get({userId:a.userId})}]}}).state("admin.organizations",{url:"/organizations/",templateUrl:"modules/organizations/client/views/admin-list-organizations.client.view.html",controller:"AdminOrganizationsController",data:{roles:["admin"]}}).state("panels",{abstract:!0,url:"/panels",template:"<ui-view/>",data:{roles:["admin"]}}).state("panels.list",{url:"/panels-list",templateUrl:"modules/panels/client/views/list-panels.client.view.html",controller:"PanelController",data:{roles:["admin"]}}).state("panels.view",{url:"/:panelId",templateUrl:"modules/panels/client/views/view-panel.client.view.html",controller:"PanelController",data:{roles:["admin"]}})}]),angular.module("users").config(["$httpProvider",function(a){a.interceptors.push(["$q","$location","Authentication",function(a,b,c){return{responseError:function(d){switch(d.status){case 401:c.user=null,b.path("signin");break;case 403:}return a.reject(d)}}}])}]),angular.module("users").config(["$stateProvider",function(a){a.state("settings",{abstract:!0,url:"/settings",templateUrl:"modules/users/client/views/settings/settings.client.view.html",data:{roles:["user","admin","seller"]}}).state("settings.profile",{url:"/profile",templateUrl:"modules/users/client/views/settings/edit-profile.client.view.html"}).state("settings.password",{url:"/password",templateUrl:"modules/users/client/views/settings/change-password.client.view.html"}).state("settings.accounts",{url:"/accounts",templateUrl:"modules/users/client/views/settings/manage-social-accounts.client.view.html"}).state("settings.picture",{url:"/picture",templateUrl:"modules/users/client/views/settings/change-profile-picture.client.view.html"}).state("authentication",{abstract:!0,url:"/authentication",templateUrl:"modules/users/client/views/authentication/authentication.client.view.html"}).state("authentication.signup",{url:"/signup?i",templateUrl:"modules/users/client/views/authentication/signup.client.view.html"}).state("authentication.signin",{url:"/signin?err",templateUrl:"modules/users/client/views/authentication/signin.client.view.html"}).state("password",{abstract:!0,url:"/password",template:"<ui-view/>"}).state("password.forgot",{url:"/forgot",templateUrl:"modules/users/client/views/password/forgot-password.client.view.html"}).state("password.reset",{abstract:!0,url:"/reset",template:"<ui-view/>"}).state("password.reset.invalid",{url:"/invalid",templateUrl:"modules/users/client/views/password/reset-password-invalid.client.view.html"}).state("password.reset.success",{url:"/success",templateUrl:"modules/users/client/views/password/reset-password-success.client.view.html"}).state("password.reset.form",{url:"/:token",templateUrl:"modules/users/client/views/password/reset-password.client.view.html"})}]),angular.module("users.admin").controller("AdminOrganizationsController",["$scope","$http","$filter","Admin",function(a,b,c,d){a.find=function(){b.get("/api/organizations-unverified").success(function(b){a.organizations=b,a.buildPager()})},a.verifyOrg=function(c){b.post("/api/organizations/"+c+"/verify").success(function(b){a.organization=b})},a.buildPager=function(){a.pagedItems=[],a.itemsPerPage=15,a.currentPage=1,a.figureOutItemsToDisplay()},a.figureOutItemsToDisplay=function(){a.filteredItems=c("filter")(a.organizations,{$:a.search}),a.filterLength=a.filteredItems.length;var b=(a.currentPage-1)*a.itemsPerPage,d=b+a.itemsPerPage;a.pagedItems=a.filteredItems.slice(b,d)},a.pageChanged=function(){a.figureOutItemsToDisplay()}}]),angular.module("users.admin").controller("UserListController",["$scope","$http","$filter","Admin",function(a,b,c,d){d.query(function(b){a.users=b,a.buildPager()}),a.getAllUsers=function(){d.query(function(b){a.users=b,a.buildPager()})},a.getFilteredUsers=function(c){b.get("/api/users?filter="+c).success(function(b){a.users=b,a.buildPager()}).error(function(a){console.log("could not fetch verified users")})},a.buildPager=function(){a.pagedItems=[],a.itemsPerPage=15,a.currentPage=1,a.figureOutItemsToDisplay()},a.figureOutItemsToDisplay=function(){a.filteredItems=c("filter")(a.users,{$:a.search}),a.filterLength=a.filteredItems.length;var b=(a.currentPage-1)*a.itemsPerPage,d=b+a.itemsPerPage;a.pagedItems=a.filteredItems.slice(b,d)},a.pageChanged=function(){a.figureOutItemsToDisplay()}}]),angular.module("users.admin").controller("UserController",["$scope","$state","$http","Authentication","userResolve",function(a,b,c,d,e){a.authentication=d,a.user=e,a.remove=function(c){confirm("Are you sure you want to delete this user?")&&(c?(c.$remove(),a.users.splice(a.users.indexOf(c),1)):a.user.$remove(function(){b.go("admin.users")}))},a.verifyUser=function(){a.user.verified||c.post("/api/users/"+a.user._id+"/verify").success(function(a){b.reload()}).error(function(a){console.log(a)})},a.update=function(c){if(!c)return a.$broadcast("show-errors-check-validity","userForm"),!1;var d=a.user;d.$update(function(){b.go("admin.user",{userId:d._id})},function(b){a.error=b.data.message})}}]),angular.module("users").controller("AuthenticationController",["$scope","$state","$http","$location","$window","Authentication","PasswordValidator","Organizations",function(a,b,c,d,e,f,g,h){a.authentication=f,a.popoverMsg=g.getPopoverMsg(),c.get("/api/organizations-basic").success(function(b){a.organizations=b}).error(function(a){console.log(a)}),a.error=d.search().err,a.authentication.user&&d.path("/"),a.signup=function(d){return a.error=null,d?(a.credentials.inviteToken=b.params.i,void c.post("/api/auth/signup",a.credentials).success(function(c){a.authentication.user=c,b.go(b.previous.state.name||"home",b.previous.params)}).error(function(b){a.error=b.message})):(a.$broadcast("show-errors-check-validity","userForm"),!1)},a.signin=function(d){return a.error=null,d?void c.post("/api/auth/signin",a.credentials).success(function(c){a.authentication.user=c,b.go(b.previous.state.name||"home",b.previous.params)}).error(function(b){a.error=b.message}):(a.$broadcast("show-errors-check-validity","userForm"),!1)},a.callOauthProvider=function(a){b.previous&&b.previous.href&&(a+="?redirect_to="+encodeURIComponent(b.previous.href)),e.location.href=a}}]),angular.module("users").controller("PasswordController",["$scope","$stateParams","$http","$location","Authentication","PasswordValidator",function(a,b,c,d,e,f){a.authentication=e,a.popoverMsg=f.getPopoverMsg(),a.authentication.user&&d.path("/"),a.askForPasswordReset=function(b){return a.success=a.error=null,b?void c.post("/api/auth/forgot",a.credentials).success(function(b){a.credentials=null,a.success=b.message}).error(function(b){a.credentials=null,a.error=b.message}):(a.$broadcast("show-errors-check-validity","forgotPasswordForm"),!1)},a.resetUserPassword=function(f){return a.success=a.error=null,f?void c.post("/api/auth/reset/"+b.token,a.passwordDetails).success(function(b){a.passwordDetails=null,e.user=b,d.path("/password/reset/success")}).error(function(b){a.error=b.message}):(a.$broadcast("show-errors-check-validity","resetPasswordForm"),!1)}}]),angular.module("users").controller("ChangePasswordController",["$scope","$http","Authentication","PasswordValidator",function(a,b,c,d){a.user=c.user,a.popoverMsg=d.getPopoverMsg(),a.changeUserPassword=function(c){return a.success=a.error=null,c?void b.post("/api/users/password",a.passwordDetails).success(function(b){a.$broadcast("show-errors-reset","passwordForm"),a.success=!0,a.passwordDetails=null}).error(function(b){a.error=b.message}):(a.$broadcast("show-errors-check-validity","passwordForm"),!1)}}]),angular.module("users").controller("ChangeProfilePictureController",["$scope","$timeout","$window","Authentication","FileUploader",function(a,b,c,d,e){a.user=d.user,a.imageURL=a.user.profileImageURL,a.uploader=new e({url:"api/users/picture",alias:"newProfilePicture"}),a.uploader.filters.push({name:"imageFilter",fn:function(a,b){var c="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(c)!==-1}}),a.uploader.onAfterAddingFile=function(d){if(c.FileReader){var e=new FileReader;e.readAsDataURL(d._file),e.onload=function(c){b(function(){a.imageURL=c.target.result},0)}}},a.uploader.onSuccessItem=function(b,c,e,f){a.success=!0,a.user=d.user=c,a.cancelUpload()},a.uploader.onErrorItem=function(b,c,d,e){a.cancelUpload(),a.error=c.message},a.uploadProfilePicture=function(){a.success=a.error=null,a.uploader.uploadAll()},a.cancelUpload=function(){a.uploader.clearQueue(),a.imageURL=a.user.profileImageURL}}]),angular.module("users").controller("EditProfileController",["$scope","$http","$location","Users","Authentication",function(a,b,c,d,e){a.user=e.user,a.updateUserProfile=function(b){if(a.success=a.error=null,!b)return a.$broadcast("show-errors-check-validity","userForm"),!1;var c=new d(a.user);c.$update(function(b){a.$broadcast("show-errors-reset","userForm"),a.success=!0,e.user=b},function(b){a.error=b.data.message})}}]),angular.module("users").controller("SocialAccountsController",["$scope","$http","Authentication",function(a,b,c){a.user=c.user,a.hasConnectedAdditionalSocialAccounts=function(b){for(var c in a.user.additionalProvidersData)return!0;return!1},a.isConnectedSocialAccount=function(b){return a.user.provider===b||a.user.additionalProvidersData&&a.user.additionalProvidersData[b]},a.removeUserSocialAccount=function(d){a.success=a.error=null,b.delete("/api/users/accounts",{params:{provider:d}}).success(function(b){a.success=!0,a.user=c.user=b}).error(function(b){a.error=b.message})}}]),angular.module("users").controller("SettingsController",["$scope","$http","Authentication",function(a,b,c){a.user=c.user,b.get("api/organizations/"+a.user.organization).success(function(b){a.user.organization=b})}]),angular.module("users").directive("passwordValidator",["PasswordValidator",function(a){return{require:"ngModel",link:function(b,c,d,e){e.$validators.requirements=function(c){var d=!0;if(c){var e=a.getResult(c),f=0,g=[{color:"danger",progress:"20"},{color:"warning",progress:"40"},{color:"info",progress:"60"},{color:"primary",progress:"80"},{color:"success",progress:"100"}];e.errors.length<g.length&&(f=g.length-e.errors.length-1),b.requirementsColor=g[f].color,b.requirementsProgress=g[f].progress,e.errors.length?(b.popoverMsg=a.getPopoverMsg(),b.passwordErrors=e.errors,d=!1):(b.popoverMsg="",b.passwordErrors=[],d=!0)}return d}}}}]),angular.module("users").directive("passwordVerify",[function(){return{require:"ngModel",scope:{passwordVerify:"="},link:function(a,b,c,d){a.$watch(function(){var b;return(a.passwordVerify||d)&&(b=a.passwordVerify+"_"+d),b},function(b){b&&(d.$validators.passwordVerify=function(b){var c=a.passwordVerify;return c===b})})}}}]),angular.module("users").directive("lowercase",function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.push(function(a){return a?a.toLowerCase():""}),b.css("text-transform","lowercase")}}}),angular.module("users").factory("Authentication",["$window",function(a){var b={user:a.user};return b}]),angular.module("users").factory("PasswordValidator",["$window",function(a){var b=a.owaspPasswordStrengthTest;return{getResult:function(a){var c=b.test(a);return c},getPopoverMsg:function(){var a="Please enter a passphrase or password with greater than 10 characters, numbers, lowercase, upppercase, and special characters.";return a}}}]),angular.module("users").factory("Users",["$resource",function(a){return a("api/users",{},{update:{method:"PUT"}})}]),angular.module("users.admin").factory("Admin",["$resource",function(a){return a("api/users/:userId",{userId:"@_id"},{update:{method:"PUT"}})}]);